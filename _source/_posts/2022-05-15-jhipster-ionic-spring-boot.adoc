---
layout: blog_post
title: "Integrate Ionic and Spring Boot Securely with JWT and OAuth 2.0"
author: matt-raible
by: advocate
communities: [mobile,java,javascript]
description: "Build an Ionic frontend for your Spring Boot backend, all using the power of JHipster!"
tags: [ionic, spring-boot, spring-security, jhipster]
tweets:
- "Create an Ionic app with a Spring Boot backend in minutes with the new Ionic blueprint for @jhipster!"
- "Introducing JHipster Ionic: 'Wow! Did you really just build that?!'"
- "Ionic is awesome. Learn how you to create apps quickly using this powerful framework. üí™"
image:
type: conversion
github: https://github.com/oktadev/okta-jhipster-ionic-example
---
:page-liquid:
:toc: macro
:experimental:
:commandkey: &#8984;

Ionic allows you to create mobile apps with web technologies that look and act like native apps. Because they're built with web technologies (HTML, JavaScript, and CSS), you can also deploy your Ionic apps as webapps. Or, even better, as progressive web apps (PWAs) that work offline.

// borrowed from https://capacitorjs.com/
image::{% asset_path 'blog/jhipster-ionic-blueprint/capacitor.png' %}[alt=Capacitor diagram,width=300,role="pull-right m-up-20",link={% asset_path 'blog/jhipster-ionic-blueprint/capacitor.png' %}]

Ionic provides support for the big three web frameworks: Angular, React, and Vue. Once you've written your app with one of these, you can deploy it to a simulator or device with https://capacitorjs.com/[Capacitor]. Capacitor (pictured on the right as the blue layer) provides the runtime for your app to communicate with the native operating system and vise versa.

Ionic's main competitors are native apps built with Swift or Objective-C (for iOS) and Java or Kotlin (for Android). Ionic also competes with React Native, which uses web technologies and translates them to native components.

The Ionic blog has a recent post that https://ionicframework.com/blog/ionic-vs-react-native-performance-comparison/[does a performance comparison between Ionic and React Native]. TL;DR: Both options will give you a high performance app with a truly native look and feel.

**Prerequisites:**

- https://nodejs.org[Node 16]
- https://sdkman.io/[Java 11]
- https://docs.docker.com/desktop/#download-and-install[Docker Desktop]

toc::[]

== ‚ú® Introducing the JHipster Ionic blueprint!

The JHipster project has provided support for generating an Ionic app using a `generator-jhipster-ionic` module for the past several years. As the primary maintainer of this module, I'm proud to announce that this module has been re-written as a blueprint and it's _much_ easier to understand now. The previous module relied on the Ionic CLI, the base Angular https://github.com/ionic-team/starters[starter], a https://github.com/oktadev/ionic-jhipster-starter[Ionic JHipster starter], and custom code to glue it all together. Now, the source code is all contained in one project.

https://github.com/mshima[Marcelo Shima] volunteered to do the conversion and after a couple of months, I'm proud to say the https://github.com/jhipster/generator-jhipster-ionic[JHipster Ionic blueprint] is now available! Here's how to use it:

Create a `ionic-app` directory alongside your JHipster app.

[source,shell]
----
- backend
- ionic-app
----

Navigate into `ionic-app` using your terminal. Install Ionic for JHipster and create a new app using `jhipster-ionic`.

[source,shell]
----
npm install -g generator-jhipster-ionic
jhipster-ionic
----

You'll be prompted for the location of your JHipster app, a name for your Ionic app, and then you'll be off to the races!

image::{% asset_path 'blog/jhipster-ionic-blueprint/jhipster-ionic.png' %}[alt=JHipster Ionic prompts,width=800,align=center]

You can also create a JHipster app and an Ionic app at the same time. The command will only work if you've already installed JHipster with `npm install -g generator-jhipster`.

[source,shell]
----
mkdir backend
cd backend
jhipster jdl bug-tracker.jh --blueprints ionic
----

This will follow the same convention where the generated backend and frontend apps are side-by-side on your hard drive.

Then you can run both apps from your Ionic app using easy-to-remember commands.

[source,shell]
----
npm run backend:start
# open a new terminal window
npm start
----

image::{% asset_path 'blog/jhipster-ionic-blueprint/ionic-serve.png' %}[alt=Ionic serve command with backend running,width=800,align=center]

NOTE: The JHipster Ionic blueprint currently only supports Angular. Now that it's a blueprint, it will be much easier to add support for Vue and React. If you're interested in helping out, please let me know! Okta is a platinum sponsor of the project and enjoys assigning bug bounties for feature development.

== Build a Mobile App with Ionic

To see Ionic + JHipster in action, let's start with a https://auth0.com/blog/full-stack-java-with-react-spring-boot-and-jhipster/[previous JHipster app I created for the Auth0 blog]. I updated the app to the latest version of JHipster (v7.8.1) and created an Ionic app with JHipster Ionic so everything is guaranteed to work. This app is a Flickr clone that allows you to upload photos, tag them, and organize them into albums. First, clone the example:

[source,shell]
----
git clone https://github.com/oktadev/okta-jhipster-ionic-example.git jhipster-ionic
cd jhipster-ionic/backend
----

Start the app:

[source,shell]
----
npm run ci:e2e:prepare # starts Keycloak and PostgreSQL in Docker
./mvnw
----

Then, navigate to `http://localhost:8080` in your favorite browser. Sign in with `admin/admin` credentials and rejoice when it all works.

Open a new terminal window and cd into the `jhipster-ionic/ionic-app` directory. Run `ionic serve` and test out the Ionic client.

// ionic client screenshot

== How to integrate Ionic and Spring Boot

JHipster makes it easy to create a Spring Boot API that's protected by Spring Security. The JHipster Ionic blueprint generates an Ionic client that talks to your Spring Boot API and understands its auth mechanism. I created the `jhipster-ionic` project using the following steps:

Install JHipster 7.8.1 and the JHipster Ionic blueprint:

[source,shell]
----
npm i -g generator-jhipster@7.8.1 generator-jhipster-ionic@7.5.0
----

Create a parent directory to hold everything:

[source,shell]
----
# take is a shortcut for mdkir && cd
take jhipster-ionic
----

Clone an existing JHipster Flickr example:

[source,shell]
----
git clone https://github.com/oktadev/auth0-full-stack-java-example.git backend
----

Create a new directory to hold your Ionic project, then run `jhipster-ionic` in it:

[source,shell]
----
take ionic-app
jhipster-ionic
----

Provide the path to your backend JHipster app and name your app `flickr2`.

image::{% asset_path 'blog/jhipster-ionic-blueprint/jhipster-ionic-flickr2.png' %}[alt=JHipster Ionic with Flickr2 app,width=800,align=center]

That's it! The blueprint will generate an Ionic client, complete with screens for editing entities, unit tests, and end-to-end tests with Cypress.

Pretty slick, don't you think?! üòé

=== Run your Spring Boot app

You'll need to start your backend first, so your Ionic app can talk to it. First, start Keycloak and PostgreSQL in Docker containers:

[source,shell]
----
cd backend
docker-compose -f src/main/docker/keycloak.yml up -d
docker-compose -f src/main/docker/postgresql.yml up -d
----

Next, update `backend/src/main/resources/config/application-prod.yml` to allow CORS from `\http://localhost:8100` and `\http://localhost:4200`.

[source,yaml]
----
jhipster:
  ...
  cors:
    allowed-origins: 'http://localhost:8100,http://localhost:4200'
    allowed-methods: '*'
    allowed-headers: '*'
    exposed-headers: 'Authorization,Link,X-Total-Count,X-${jhipster.clientApp.name}-alert,X-${jhipster.clientApp.name}-error,X-${jhipster.clientApp.name}-params'
    allow-credentials: true
    max-age: 1800
----

Then, start the backend app using `./mvnw -Pprod`. You should be able to log in at `\http://localhost:8080` (with `admin/admin`) and add new photos using *Entities* > *Photos*. Add a few photos so you have some data to work with.

image::{% asset_path 'blog/jhipster-ionic-blueprint/flickr2-photos.jpg' %}[alt=Flickr2 photos,width=800,align=center]

=== Run your Ionic app

Open another terminal and navigate to the `ionic-app` folder. Launch your Ionic client using `ionic serve` (or `npm start`). The app will be opened at `\http://localhost:8100` in your default browser.

image::{% asset_path 'blog/jhipster-ionic-blueprint/ionic-app.png' %}[alt=Ionic app,width=580,align=center]

You should be able to log in with Keycloak and see all the listed entities in your app.

image::{% asset_path 'blog/jhipster-ionic-blueprint/ionic-entities.png' %}[alt=Ionic entities,width=580,align=center]

In the JHipster app's tutorial, there's a section where you're instructed to remove photo fields that can be calculated. Specifically, height, width, date taken, and date uploaded. These values are calculated when the photos are uploaded, so there's no reason to display them when adding a photo.

To add this same functionality to your Ionic app, modify `src/app/pages/entities/photo/photo-update.html` and wrap these fields with `<div *ngIf="!isNew">`.

[source,html]
----
<div *ngIf="!isNew">
  <ion-item>
    <ion-label position="floating">Height</ion-label>
    <ion-input type="number" name="height" formControlName="height"></ion-input>
  </ion-item>
  ...
  <ion-item>
    <ion-label>Uploaded</ion-label>
    <ion-datetime displayFormat="MM/DD/YYYY HH:mm" formControlName="uploaded" id="field_uploaded"></ion-datetime>
  </ion-item>
</div>
----

////
You can comment out (or delete) the following lines in `cypress/integration/entities/photo/photo.e2e-spec.ts` so Cypress doesn't try to enter these values when running end-to-end (e2e) tests.

[source,ts]
----
/*if (photoSample.height !== undefined && photoSample.height !== null) {
  photoUpdatePage.setHeightInput(photoSample.height);
}
if (photoSample.width !== undefined && photoSample.width !== null) {
  photoUpdatePage.setWidthInput(photoSample.width);
}
if (photoSample.taken !== undefined && photoSample.taken !== null) {
  photoUpdatePage.setTakenInput(photoSample.taken);
}
if (photoSample.uploaded !== undefined && photoSample.uploaded !== null) {
  photoUpdatePage.setUploadedInput(photoSample.uploaded);
}*/
----
////


When you save these files, the Ionic CLI will auto-compile and reload the app in your browser. You can prove everything works as expected by stopping your app (with kbd:[Ctrl + C]) and running all the e2e tests.

[source,shell]
----
npm run e2e
----

== Run your Ionic app on iOS using Capacitor

Generate a native iOS project with the following commands:

[source,shell]
----
npx ionic build
npx ionic capacitor add ios
----

Add your custom scheme (`dev.localhost.ionic`) to `ios/App/App/Info.plist`. This is configured in `src/environments/environment.ts`; you can easily change it to something else if you like.
[source,xml]
----
<key>CFBundleURLTypes</key>
<array>
  <dict>
    <key>CFBundleURLName</key>
    <string>com.getcapacitor.capacitor</string>
    <key>CFBundleURLSchemes</key>
    <array>
      <string>capacitor</string>
      <string>dev.localhost.ionic</string>
    </array>
  </dict>
</array>
----

Modify the JHipster app's CORS settings (in `backend/src/main/resources/config/application-prod.yml`) to allow `capacitor://localhost` as an origin.

[source,yaml]
----
jhipster:
  ...
  cors:
    allowed-origins: '...,capacitor://localhost'
----

Restart your backend app. Deploy your Ionic app to iOS Simulator and run it.

[source,shell]
----
npx cap run ios
----

image::{% asset_path 'blog/jhipster-ionic-blueprint/flickr2-simulator.png' %}[alt=Flickr2 running on Simulator,width=300,align=center]

=== Run your Ionic app on Android

Generate an Android project with Capacitor.

[source,shell]
----
ionic capacitor add android
----

Change the custom scheme in `android/app/src/main/res/values/strings.xml` to use `dev.localhost.ionic`:

[source,xml]
----
<string name="custom_url_scheme">dev.localhost.ionic</string>
----

////
todo: confirm this is necessary

The https://github.com/EddyVerbruggen/cordova-plugin-safariviewcontroller[SafariViewController Cordova Plugin] is installed as part of this project. Capacitor uses AndroidX dependencies, but the SafariViewController plugin uses an older non-AndroidX dependency. Use https://developer.android.com/studio/command-line/jetifier[jetifier] to patch usages of old support libraries with the following commands:

[source,shell]
----
npm install -D jetifier
npx jetify
----
////

Sync the compiled project files with the Android project.

----
npx cap sync android
----

Next, run your project using the Capacitor CLI:

[source,shell]
----
npx cap run android
----

CAUTION: If you get an error when running this command, make sure you're using Java 11.

// Apple M1 doesn't run AVDs: Device Manager terminates
// todo: try on Intel

You'll need to run a couple commands to allow the emulator to communicate with JHipster and Keycloak.

[source,shell]
----
adb reverse tcp:8080 tcp:8080
adb reverse tcp:9080 tcp:9080
----

If you see `java.io.IOException: Cleartext HTTP traffic to localhost not permitted` in your Android Studio console, enable clear text traffic in `android/app/src/main/AndroidManifest.xml`:

[source,xml]
----
<application
    ...
    android:usesCleartextTraffic="true">
----

You should be able to log in and edit entities, just like you can in a browser and on iOS!

// todo: screenshot of Android

== Why use OpenID Connect for mobile apps?

Storing link:/blog/2019/01/22/oauth-api-keys-arent-safe-in-mobile-apps[API keys and secrets in mobile apps is not safe].

// The following two paragraphs copied from: link:/blog/2019/01/22/oauth-api-keys-arent-safe-in-mobile-apps#how-to-protect-secrets-in-mobile-apps

OAuth 2.0 solves this problem by not shipping any secrets in mobile apps, and instead involving the user in the process of getting an access token into the app. These access tokens are unique per user and every time they log in. The https://www.oauth.com/oauth2-servers/pkce/[PKCE extension] provides a solution for securely doing the OAuth flow on a mobile app even when there is no pre-provisioned secret.

If you need to access an API from a mobile app, hopefully it supports OAuth and PKCE! Thankfully most of the hard work of PKCE is handled by SDKs like https://appauth.io/[AppAuth] so you don't have to write all that code yourself. If you're working with an API like Okta, then Okta's own SDKs do PKCE automatically so you don't have to worry about it at all.

=== Switch your identity provider to Okta

If you don't have an Okta developer account, you can https://developer.okta.com/signup[sign up for one] or run `okta register` after installing the Okta CLI.

If you want to change your JHipster app to use Okta, the https://cli.okta.com[Okta CLI] makes this as easy as `okta apps create jhipster`. When you run this command, it creates an `.okta.env` file you can source to override the default Keycloak settings.

[source,shell]
----
source .okta.env
./mvnw -Pprod
----

To learn more about how this works, see https://www.jhipster.tech/security/#okta[JHipster's Okta documentation]. With Keycloak, you don't need a separate OIDC app for Ionic. With Okta, you do.

Learn how in JHipster's documentation on how to https://www.jhipster.tech/security/#create-a-native-app-for-mobile-on-okta[create a native app for mobile on Okta].

After you've changed the client ID in your Ionic app, run it using `npm start`. You'll be prompted to log in using your Okta credentials at `\http://localhost:8100`.

=== Switch your identity provider to Auth0

To switch your identity provider to Auth0, you first need an https://auth0.com/signup[Auth0 account]. Then, create an `.auth0.env` file and see https://www.jhipster.tech/security/#auth0[JHipster's Auth0 docs] for how to populate it.

Next, https://www.jhipster.tech/security/#create-a-native-app-for-mobile-on-auth0[configure a native app for mobile on Auth0]. Once you're finished, you should be able to run your backend and new frontend client using the following commands:

// todo: make sure this is in JHipster's Auth0 docs:
// TIP: Want to have all these steps automated for you? Add a üëç to https://github.com/auth0/auth0-cli/issues/351[issue #351] in the Auth0 CLI project.

[source,shell]
----
source .auth0.env
npm run backend:start
# one a new terminal
npm start
----

To see it in action on your mobile emulators, use the following commands:

[source,shell]
----
# iOS
npx cap sync ios
npx cap run ios

# Android
npx cap sync android
npx cap run android
----

////
== Todo: doesn't work

- Ionic Android login
- Auth0 logout
////

== Learn more about Ionic, Spring Boot, and JHipster

I hope you've enjoyed learning about Ionic and the new Ionic blueprint for JHipster. In my opinion, it's pretty neat that you can rapidly prototype a mobile client for your JHipster. It's even better that you can use a leading-edge mobile application framework to do it.

You can find the source code for this example on GitHub, in the https://github.com/oktadev/okta-jhipster-ionic-example[@oktadev/okta-jhipster-ionic-example] repository.

If you liked this post, you might like these others too.

- link:/blog/2020/09/21/ionic-apple-google-signin[Ionic + Sign in with Apple and Google]
- link:/blog/2020/12/28/spring-boot-docker[How to Docker with Spring Boot]
- https://auth0.com/blog/full-stack-java-with-react-spring-boot-and-jhipster/[Full Stack Java with React, Spring Boot, and JHipster]
- link:/blog/2022/02/16/spring-data-elasticsearch[A Quick Guide to Elasticsearch with Spring Data and Spring Boot]

If you have any questions, please leave a comment below. You can follow https://twitter.com/oktadev[@oktadev on Twitter] and subscribe to https://youtube.com/oktadev[our YouTube channel] for more leading-edge content. We're also on https://www.linkedin.com/company/oktadev/[LinkedIn] and https://www.facebook.com/oktadevelopers/[Facebook].
