---
layout: blog_post
title: "Integrate Ionic and Spring Boot Securely with JWT and OAuth 2.0"
author: matt-raible
by: advocate
communities: [mobile,java,javascript]
description: "Build an Ionic frontend for your Spring Boot backend, all using the power of JHipster!"
tags: [ionic, spring-boot, spring-security, jhipster]
tweets:
- "Create an Ionic app with a Spring Boot backend in minutes with the new Ionic blueprint for @jhipster!"
- "Introducing JHipster Ionic: 'Wow! Did you really just build that?!'"
- "Ionic is awesome. Learn how you to create apps quickly using this powerful framework. 💪"
image:
type: conversion
github: https://github.com/oktadev/okta-jhipster-ionic-example
---
:page-liquid:
:toc: macro
:experimental:
:commandkey: &#8984;

Ionic allows you to create mobile apps with web technologies that look and act like native apps. Because they're built with web technologies (HTML, JavaScript, and CSS), you can also deploy your Ionic apps as webapps. Or, even better, as progressive web apps (PWAs) that work offline.

// borrowed from https://capacitorjs.com/
image::{% asset_path 'blog/jhipster-ionic-blueprint/capacitor.png' %}[alt=Capacitor diagram,width=300,role="pull-right m-up-20",link={% asset_path 'blog/jhipster-ionic-blueprint/capacitor.png' %}]

Ionic provides support for the big three web frameworks: Angular, React, and Vue. Once you've written your app with one of these, you can deploy it to a simulator or device with https://capacitorjs.com/[Capacitor]. Capacitor (pictured on the right as the blue layer) provides the runtime for your app to communicate with the native operating system and vise versa.

Ionic's main competitors are native apps built with Swift or Objective-C (for iOS) and Java or Kotlin (for Android). Ionic also competes with React Native, which uses web technologies and translates them to native components.

The Ionic blog has a recent post that https://ionicframework.com/blog/ionic-vs-react-native-performance-comparison/[does a performance comparison between Ionic and React Native]. TL;DR: Both options will give you a high performance app with a truly native look and feel.

**Prerequisites:**

- https://nodejs.org[Node 16+]
- https://sdkman.io/[Java 11+]
- https://docs.docker.com/desktop/#download-and-install[Docker Desktop]

toc::[]

== ✨ Introducing the JHipster Ionic blueprint!

The JHipster project has provided support for generating an Ionic app using a `generator-jhipster-ionic` module for the past several years. As the primary maintainer of this module, I'm proud to announce that this module has been re-written as a blueprint and it's _much_ easier to understand now. The previous module relied on the Ionic CLI, the base Angular https://github.com/ionic-team/starters[starter], a https://github.com/oktadev/ionic-jhipster-starter[Ionic JHipster starter], and custom code to glue it all together. Now, the source code is all contained in one project.

https://github.com/mshima[Marcelo Shima] volunteered to do the conversion and after a couple of months, I'm proud to say the https://github.com/jhipster/generator-jhipster-ionic[JHipster Ionic blueprint] is now available! Here's how to use it:

Create a `ionic-app` directory alongside your JHipster app.

[source,shell]
----
- jhipster-app
- ionic-app
----

Navigate into it using your terminal. Install Ionic for JHipster and create a new app using `jhipster-ionic`.

[source,shell]
----
npm install -g generator-jhipster-ionic@8
jhipster-ionic
----

You'll be prompted for the location of your JHipster app, a name for your Ionic app, and then you'll be off to the races!

image::{% asset_path 'blog/jhipster-ionic-blueprint/jhipster-ionic.png' %}[alt=JHipster Ionic prompts,width=800,align=center]

You can also create a JHipster app and an Ionic app at the same time using the following command:

[source,shell]
----
jhipster jdl bug-tracker.jh --blueprints ionic
----

This will follow the same convention where the generated backend and frontend apps are side-by-side on your hard drive.

Then you can run both apps from your Ionic app using easy-to-remember commands.

[source,shell]
----
npm run backend:start
# open a new terminal window
ionic serve
----

image::{% asset_path 'blog/jhipster-ionic-blueprint/ionic-serve.png' %}[alt=Ionic serve command with backend running,width=800,align=center]

NOTE: The JHipster Ionic blueprint currently only supports Angular. However, with this refactoring, it should be much easier to add support for Vue and React. If you're interested in helping out, please let me know! Okta is a platinum sponsor of the project and enjoys assigning bug bounties for feature development.

== Build a Mobile App with Ionic

To see Ionic + JHipster in action, let's look at a https://auth0.com/blog/full-stack-java-with-react-spring-boot-and-jhipster/[previous JHipster app I created for the Auth0 blog]. This app is a Flickr clone that allows you to upload photos, tag them, and organize them into albums. First, clone the example:

[source,shell]
----
git clone https://github.com/oktadev/auth0-full-stack-java-example.git backend
cd backend
----

Install JHipster 7.8 and the JHipster Ionic blueprint:

[source,shell]
----
npm i -g generator-jhipster@7.8
npm i -g generator-jhipster-ionic@8
----

Create a new directory to hold your Ionic project, then run `jhipster-ionic`:

[source,shell]
----
mkdir ionic-app
cd ionic-app
jhipster-ionic
----

Provide the path to your backend JHipster app and name your app `flickr2`.

image::{% asset_path 'blog/jhipster-ionic-blueprint/jhipster-ionic-flickr2.png' %}[alt=JHipster Ionic with Flickr2 app,width=800,align=center]

That's it! The blueprint will generate an Ionic client, complete with screens for editing entities, unit tests, and end-to-end tests with Protractor. Yes, we're https://github.com/jhipster/generator-jhipster-ionic/issues/639[working on moving to Cypress] for end-to-end tests.

Petty slick, don't you think?

=== Run your Spring Boot app

You'll need to start your backend first, so your Ionic app can talk to it. First, start Keycloak and PostgreSQL in Docker containers:

[source,shell]
----
cd backend
docker-compose -f src/main/docker/keycloak.yml up -d
docker-compose -f src/main/docker/postgresql.yml up -d
----

Next, update `backend/src/main/resources/config/application-prod.yml` to allow CORS from `\http://localhost:8100`.

[source,yaml]
----
jhipster:
  ...
  cors:
    allowed-origins: 'http://localhost:8100'
    allowed-methods: '*'
    allowed-headers: '*'
    exposed-headers: 'Authorization,Link,X-Total-Count,X-${jhipster.clientApp.name}-alert,X-${jhipster.clientApp.name}-error,X-${jhipster.clientApp.name}-params'
    allow-credentials: true
    max-age: 1800
----

Then, start the backend app using `./mvnw -Pprod`. You should be able to log in at `http://localhost:8080` (with `admin/admin`) and add new photos using *Entities* > *Photos*. Add a few photos so you have some data to work with.

image::{% asset_path 'blog/jhipster-ionic-blueprint/flickr2-photos.png' %}[alt=Flickr2 photos,width=800,align=center]

=== Run your Ionic app

Open another terminal and navigate to the `ionic-app` folder. Launch your Ionic client using `ionic serve` (or `npm start`). The app will be opened at `\http://localhost:8100` in your default browser.

image::{% asset_path 'blog/jhipster-ionic-blueprint/ionic-app.png' %}[alt=Ionic app,width=657,align=center]

You should be able to log in with Keycloak and see all the listed entities in your app.

image::{% asset_path 'blog/jhipster-ionic-blueprint/ionic-entities.png' %}[alt=Ionic entities,width=580,align=center]

In the JHipster app's tutorial, there's a section where you're instructed to remove photo fields that can be calculated. Specifically, height, width, date taken, and date uploaded. These values are calculated when the photos are uploaded, so there's no reason to display them when adding a photo.

To add this same functionality to your Ionic app, modify `src/app/pages/entities/photo/photo-update.html` and wrap these fields with `<div *ngIf="!isNew">`.

[source,html]
----
<div *ngIf="!isNew">
  <ion-item>
    <ion-label position="floating">Height</ion-label>
    <ion-input type="number" name="height" formControlName="height"></ion-input>
  </ion-item>
  ...
  <ion-item>
    <ion-label>Uploaded</ion-label>
    <ion-datetime displayFormat="MM/DD/YYYY HH:mm" formControlName="uploaded" id="field_uploaded"></ion-datetime>
  </ion-item>
</div>
----

You'll want to comment out the following lines in `e2e/entities/photo/photo.e2e-spec.ts` so Protractor doesn't try to enter these values when running end-to-end (e2e) tests.

[source,ts]
----
// await photoUpdatePage.setHeightInput(height);
// await photoUpdatePage.setWidthInput(width);
----

When you save these files, the Ionic CLI will auto-compile and reload the app in your browser. You can prove everything works as expected by stopping your app (with kbd:[Ctrl + 0]) and running all the e2e tests.

[source,shell]
----
npm run e2e
----

////
At this point, the Ionic e2e tests fail to compile

https://github.com/jhipster/generator-jhipster-ionic/issues/579

e2e/entities/photo/photo.e2e-spec.ts:60:41 - error TS2552: Cannot find name 'image'. Did you mean 'Image'?

60     await photoUpdatePage.setImageInput(image);
////

== Run your Ionic app on iOS using Capacitor

Generate a native iOS project with the following commands:

[source,shell]
----
ionic build
ionic capacitor add ios
----

Add your custom scheme (`dev.localhost.ionic`) to `ios/App/App/Info.plist`. This is configured in `src/environments/environment.ts`; you can easily change it something else if you like.

// todo: update src/app/auth/factories/auth.factory.ts to use {scheme} from environment

[source,xml]
----
<key>CFBundleURLTypes</key>
<array>
  <dict>
    <key>CFBundleURLName</key>
    <string>com.getcapacitor.capacitor</string>
    <key>CFBundleURLSchemes</key>
    <array>
      <string>capacitor</string>
      <string>dev.localhost.ionic</string>
    </array>
  </dict>
</array>
----

Modify the JHipster app's CORS settings (in `backend/src/main/resources/config/application-prod.yml`) to allow `capacitor://localhost` as an origin.

[source,yaml]
----
jhipster:
  ...
  cors:
    allowed-origins: 'http://localhost:8100,capacitor://localhost'
----

Restart your backend app. Deploy your Ionic app to iOS Simulator and run it.

[source,shell]
----
npx cap run ios
----

image::{% asset_path 'blog/jhipster-ionic-blueprint/flickr2-simulator.png' %}[alt=Flickr2 running on Simulator,width=585,align=center]

=== Run your Ionic app on Android

Generate an Android project with Capacitor.

[source,shell]
----
ionic capacitor add android
----

Change the custom scheme in `android/app/src/main/res/values/strings.xml` to use `dev.localhost.ionic`:

[source,xml]
----
<string name="custom_url_scheme">dev.localhost.ionic</string>
----

////
todo: confirm this is necessary

The https://github.com/EddyVerbruggen/cordova-plugin-safariviewcontroller[SafariViewController Cordova Plugin] is installed as part of this project. Capacitor uses AndroidX dependencies, but the SafariViewController plugin uses an older non-AndroidX dependency. Use https://developer.android.com/studio/command-line/jetifier[jetifier] to patch usages of old support libraries with the following commands:

[source,shell]
----
npm install -D jetifier
npx jetify
----
////

Sync the compiled project files with the Android project.

----
npx cap sync android
----

Next, run your project using the Capacitor CLI:

[source,shell]
----
npx cap run android
----

////
        FAILURE: Build failed with an exception.

        * What went wrong:
        Could not open settings generic class cache for settings file
        '/Users/mraible/Downloads/okta-jhipster-ionic-example/ionic-app/android/settings.gradle'
        (/Users/mraible/.gradle/caches/7.0/scripts/e9mpndfhapalb0yx4e9cyujbp).
        > BUG! exception in phase 'semantic analysis' in source unit '_BuildScript_' Unsupported
        class file major version 61
////

You'll need to run a couple commands to allow the emulator to communicate with JHipster and Keycloak.

[source,shell]
----
adb reverse tcp:8080 tcp:8080
adb reverse tcp:9080 tcp:9080
----

If you see `java.io.IOException: Cleartext HTTP traffic to localhost not permitted` in your Android Studio console, enable clear text traffic in `android/app/src/main/AndroidManifest.xml`:

[source,xml]
----
<application
    ...
    android:usesCleartextTraffic="true">
----

You should be able to log in and edit entities, just like you can in a browser and on iOS!

[screenshot of Android]

== Why use OpenID Connect for mobile apps?

// grab 1-2 paragraphs from one of Aaron's mobile posts
// mention SSO and login/logout prompt from iOS

=== Switch your identity provider to Okta

If you don't have an Okta developer account, you can https://developer.okta.com/signup[sign up for one] or run `okta register` after installing the Okta CLI.

If you want to change your JHipster app to use Okta, the https://cli.okta.com[Okta CLI] makes this as easy as `okta apps create jhipster`. When you run this command, it creates an `.okta.env` file you can source to override the default Keycloak settings.

[source,shell]
----
source .okta.env
./mvnw -Pprod
----

To learn more about how this works, see https://www.jhipster.tech/security/#okta[JHipster's Okta documentation]. With Keycloak, you don't need a separate OIDC app for Ionic. With Okta, you do.

See https://www.jhipster.tech/security/#create-a-native-app-for-mobile-on-okta[create a native app for mobile on Okta] for more information.

After you've changed the client ID in your Ionic app, run it using `npm start`. You'll be prompted to log in using your Okta credentials at `\http://localhost:8100`.

=== Switch your identity provider to Auth0

To switch your identity provider to Auth0, you first need an https://auth0.com/signup[Auth0 account]. Then, create an `.auth0.env` file and see https://www.jhipster.tech/security/#auth0[JHipster's Auth0 docs] for how to populate it.

Next, https://www.jhipster.tech/security/#create-a-native-app-for-mobile-on-auth0[configure a native app for mobile on Auth0]. Once you're finished, you should be able to run your backend and new frontend client using the following commands:

// todo: make sure this is in JHipster's Auth0 docs:
// TIP: Want to have all these steps automated for you? Add a 👍 to https://github.com/auth0/auth0-cli/issues/351[issue #351] in the Auth0 CLI project.

[source,shell]
----
source .auth0.env
npm run backend:start
# one a new terminal
npm start
----

To see it in action on your mobile emulators, use the following commands:

[source,shell]
----
# iOS
npx cap sync ios
npx cap run ios

# Android
npx cap sync android
npx cap run android
----

////
== Todo: doesn't work

- Ionic Android login
- Auth0 logout
////

== Learn more about Ionic, Spring Boot, and JHipster

I hope you've enjoyed learning about Ionic and the new Ionic blueprint for JHipster. In my opinion, it's pretty neat that you can rapidly prototype a mobile client for your JHipster. It's even better that you can use a leading-edge mobile application framework to do it.

You can find the source code for this example on GitHub, in the https://github.com/oktadev/okta-jhipster-ionic-example[@oktadev/okta-jhipster-ionic-example] repository.

If you liked this post, you might like these others too.

- Ionic with Social Login
- Spring Boot Docker
- Full Stack JHipster from Auth0 blog
- Elasticsearch + JHipster

If you have any questions, please leave a comment below. You can follow https://twitter.com/oktadev[@oktadev on Twitter] and subscribe to https://youtube.com/oktadev[our YouTube channel] for more leading-edge content. We're also on [LinkedIn] and [Facebook].
